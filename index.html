<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI水军评论检测与溯源系统</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <!-- 登录注册页面容器 -->
    <div id="auth-app" v-if="!isLoggedIn">
        <div class="auth-container">
            <!-- 登录表单 -->
            <div class="auth-form" v-if="authMode === 'login'">
                <div class="auth-header">
                    <div class="logo">
                        <i class="fas fa-robot"></i>
                        <h1>AI水军检测系统</h1>
                    </div>
                    <p class="welcome-text">欢迎回来，请登录您的账户</p>
                </div>
                
                <div class="form-group">
                    <label for="loginUsername">
                        <i class="fas fa-user"></i> 用户名
                    </label>
                    <input 
                        type="text" 
                        id="loginUsername" 
                        v-model="loginForm.username" 
                        placeholder="请输入用户名"
                        @keyup.enter="login"
                    >
                    <div class="error-message" v-if="loginErrors.username">
                        {{ loginErrors.username }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">
                        <i class="fas fa-lock"></i> 密码
                    </label>
                    <input 
                        :type="showLoginPassword ? 'text' : 'password'" 
                        id="loginPassword" 
                        v-model="loginForm.password" 
                        placeholder="请输入密码"
                        @keyup.enter="login"
                    >
                    <button 
                        type="button" 
                        class="password-toggle"
                        @click="showLoginPassword = !showLoginPassword"
                    >
                        <i :class="showLoginPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                    </button>
                    <div class="error-message" v-if="loginErrors.password">
                        {{ loginErrors.password }}
                    </div>
                </div>
                
                <div class="form-group remember-forgot">
                    <label class="remember-me">
                        <input type="checkbox" v-model="loginForm.remember">
                        <span>记住我</span>
                    </label>
                    <a href="#" class="forgot-password" @click.prevent="forgotPassword">
                        忘记密码？
                    </a>
                </div>
                
                <button class="auth-btn primary" @click="login" :disabled="loggingIn">
                    <i class="fas fa-sign-in-alt"></i>
                    {{ loggingIn ? '登录中...' : '登录' }}
                </button>
                
                <div class="divider">
                    <span>或</span>
                </div>
                
                <button class="auth-btn secondary" @click="authMode = 'register'">
                    <i class="fas fa-user-plus"></i>
                    创建新账户
                </button>
                
                <div class="demo-accounts">
                    <h4>演示账户</h4>
                    <div class="demo-account-list">
                        <div class="demo-account" @click="useDemoAccount('admin')">
                            <span class="role-tag admin">管理员</span>
                            <span>admin / admin123</span>
                        </div>
                        <div class="demo-account" @click="useDemoAccount('analyst')">
                            <span class="role-tag analyst">分析师</span>
                            <span>analyst / analyst123</span>
                        </div>
                        <div class="demo-account" @click="useDemoAccount('visitor')">
                            <span class="role-tag visitor">访客</span>
                            <span>visitor / visitor123</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 注册表单 -->
            <div class="auth-form" v-if="authMode === 'register'">
                <div class="auth-header">
                    <div class="logo">
                        <i class="fas fa-robot"></i>
                        <h1>AI水军检测系统</h1>
                    </div>
                    <p class="welcome-text">创建新账户，开始使用我们的服务</p>
                </div>
                
                <div class="form-group">
                    <label for="registerUsername">
                        <i class="fas fa-user"></i> 用户名
                    </label>
                    <input 
                        type="text" 
                        id="registerUsername" 
                        v-model="registerForm.username" 
                        placeholder="请输入用户名"
                    >
                    <div class="error-message" v-if="registerErrors.username">
                        {{ registerErrors.username }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">
                        <i class="fas fa-envelope"></i> 邮箱
                    </label>
                    <input 
                        type="email" 
                        id="registerEmail" 
                        v-model="registerForm.email" 
                        placeholder="请输入邮箱地址"
                    >
                    <div class="error-message" v-if="registerErrors.email">
                        {{ registerErrors.email }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">
                        <i class="fas fa-lock"></i> 密码
                    </label>
                    <input 
                        :type="showRegisterPassword ? 'text' : 'password'" 
                        id="registerPassword" 
                        v-model="registerForm.password" 
                        placeholder="请输入密码（至少8位）"
                    >
                    <button 
                        type="button" 
                        class="password-toggle"
                        @click="showRegisterPassword = !showRegisterPassword"
                    >
                        <i :class="showRegisterPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                    </button>
                    <div class="error-message" v-if="registerErrors.password">
                        {{ registerErrors.password }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">
                        <i class="fas fa-lock"></i> 确认密码
                    </label>
                    <input 
                        :type="showConfirmPassword ? 'text' : 'password'" 
                        id="confirmPassword" 
                        v-model="registerForm.confirmPassword" 
                        placeholder="请再次输入密码"
                    >
                    <button 
                        type="button" 
                        class="password-toggle"
                        @click="showConfirmPassword = !showConfirmPassword"
                    >
                        <i :class="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                    </button>
                    <div class="error-message" v-if="registerErrors.confirmPassword">
                        {{ registerErrors.confirmPassword }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="registerRole">
                        <i class="fas fa-user-tag"></i> 角色
                    </label>
                    <select id="registerRole" v-model="registerForm.role">
                        <option value="visitor">访客</option>
                        <option value="analyst">安全分析师</option>
                        <option value="admin">系统管理员</option>
                    </select>
                    <div class="role-hint">
                        <i class="fas fa-info-circle"></i>
                        <span>不同角色拥有不同的权限</span>
                    </div>
                </div>
                
                <div class="form-group terms-agreement">
                    <label class="terms-label">
                        <input type="checkbox" v-model="registerForm.agreeTerms">
                        <span>我同意 <a href="#" @click.prevent="showTerms">服务条款</a> 和 <a href="#" @click.prevent="showPrivacy">隐私政策</a></span>
                    </label>
                    <div class="error-message" v-if="registerErrors.agreeTerms">
                        {{ registerErrors.agreeTerms }}
                    </div>
                </div>
                
                <button class="auth-btn primary" @click="register" :disabled="registering">
                    <i class="fas fa-user-plus"></i>
                    {{ registering ? '注册中...' : '注册账户' }}
                </button>
                
                <div class="divider">
                    <span>已有账户？</span>
                </div>
                
                <button class="auth-btn secondary" @click="authMode = 'login'">
                    <i class="fas fa-sign-in-alt"></i>
                    返回登录
                </button>
            </div>
            
            <!-- 忘记密码表单 -->
            <div class="auth-form" v-if="authMode === 'forgot'">
                <div class="auth-header">
                    <div class="logo">
                        <i class="fas fa-robot"></i>
                        <h1>重置密码</h1>
                    </div>
                    <p class="welcome-text">请输入您的邮箱地址，我们将发送重置密码的链接</p>
                </div>
                
                <div class="form-group">
                    <label for="forgotEmail">
                        <i class="fas fa-envelope"></i> 邮箱地址
                    </label>
                    <input 
                        type="email" 
                        id="forgotEmail" 
                        v-model="forgotForm.email" 
                        placeholder="请输入注册时使用的邮箱"
                    >
                    <div class="error-message" v-if="forgotErrors.email">
                        {{ forgotErrors.email }}
                    </div>
                </div>
                
                <button class="auth-btn primary" @click="resetPassword" :disabled="resetting">
                    <i class="fas fa-paper-plane"></i>
                    {{ resetting ? '发送中...' : '发送重置链接' }}
                </button>
                
                <div class="divider">
                    <span>或</span>
                </div>
                
                <button class="auth-btn secondary" @click="authMode = 'login'">
                    <i class="fas fa-arrow-left"></i>
                    返回登录
                </button>
            </div>
            
            <!-- 系统公告 -->
            <div class="system-notice">
                <div class="notice-header">
                    <i class="fas fa-bullhorn"></i>
                    <h3>系统公告</h3>
                </div>
                <div class="notice-content">
                    <p><i class="fas fa-check-circle"></i> 新增AI水军集群检测功能</p>
                    <p><i class="fas fa-check-circle"></i> 支持多平台评论数据分析</p>
                    <p><i class="fas fa-check-circle"></i> 实时可视化风险报告</p>
                    <p><i class="fas fa-check-circle"></i> 智能证据链生成系统</p>
                </div>
            </div>
        </div>
        
        <!-- 通知消息 -->
        <div v-if="authNotifications.length > 0" class="auth-notifications">
            <div v-for="notification in authNotifications" 
                 :key="notification.id"
                 class="auth-notification"
                 :class="'notification-' + notification.type">
                <i :class="getNotificationIcon(notification.type)"></i>
                <span>{{ notification.message }}</span>
                <button class="close-notification" @click="removeAuthNotification(notification.id)">
                    &times;
                </button>
            </div>
        </div>
        
        <!-- 版权信息 -->
        <div class="copyright">
            <p>© 2024 AI水军检测系统 | 版本 2.0.1 | 技术支持: detection@system.com</p>
            <p>本系统仅供内部测试使用，请遵守相关法律法规</p>
        </div>
    </div>
    
    <!-- 主应用页面 -->
    <div id="app" v-if="isLoggedIn">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-robot"></i>
                <h1>AI水军检测系统</h1>
            </div>
            <div class="user-info">
                <div class="api-status" :class="apiStatus.healthy ? 'healthy' : 'unhealthy'">
                    <i :class="apiStatus.healthy ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle'"></i>
                    <span>{{ apiStatus.message }}</span>
                </div>
                
                <div class="role-selector">
                    <label for="role">当前角色:</label>
                    <select id="role" v-model="currentRole" @change="changeRole">
                        <option value="admin">系统管理员</option>
                        <option value="analyst">安全分析师</option>
                        <option value="visitor">访客</option>
                    </select>
                </div>
                <div class="user-dropdown">
                    <div class="user" @click="toggleUserDropdown">
                        <i class="fas fa-user-circle"></i>
                        <span>{{ userName }}</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="dropdown-menu" v-if="showUserDropdown">
                        <div class="dropdown-header">
                            <i class="fas fa-user"></i>
                            <div class="user-details">
                                <strong>{{ userName }}</strong>
                                <small>{{ userEmail }}</small>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" @click.prevent="viewProfile">
                            <i class="fas fa-user-edit"></i>
                            个人信息
                        </a>
                        <a href="#" class="dropdown-item" @click.prevent="changePassword">
                            <i class="fas fa-key"></i>
                            修改密码
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout" @click.prevent="logout">
                            <i class="fas fa-sign-out-alt"></i>
                            退出登录
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- 侧边栏导航 -->
            <nav class="sidebar">
                <ul>
                    <li @click="changeTab('dashboard')" :class="{active: activeTab === 'dashboard'}">
                        <i class="fas fa-tachometer-alt"></i> 仪表盘
                    </li>
                    <li @click="changeTab('dataManagement')" :class="{active: activeTab === 'dataManagement'}">
                        <i class="fas fa-database"></i> 数据管理
                    </li>
                    <li @click="changeTab('aiDetection')" :class="{active: activeTab === 'aiDetection'}">
                        <i class="fas fa-search"></i> AI检测分析
                    </li>
                    <li @click="changeTab('visualization')" :class="{active: activeTab === 'visualization'}">
                        <i class="fas fa-chart-network"></i> 可视化分析
                    </li>
                    <li v-if="currentRole === 'admin' || currentRole === 'analyst'" 
                        @click="changeTab('systemManagement')" 
                        :class="{active: activeTab === 'systemManagement'}">
                        <i class="fas fa-cog"></i> 系统管理
                    </li>
                </ul>
            </nav>

            <!-- 主内容区域 -->
            <main class="main-content">
                <!-- 仪表盘页面 -->
                <div v-if="activeTab === 'dashboard'" class="dashboard">
                    <h2><i class="fas fa-tachometer-alt"></i> 系统仪表盘</h2>
                    
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: #4CAF50;">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="stat-info">
                                <h3>{{ formatNumber(stats.totalComments) }}</h3>
                                <p>总评论数</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: #FF5722;">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="stat-info">
                                <h3>{{ formatNumber(stats.aigcComments) }}</h3>
                                <p>AIGC疑似评论</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: #2196F3;">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3>{{ stats.waterArmyClusters }}</h3>
                                <p>水军集群数</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background-color: #9C27B0;">
                                <i class="fas fa-user-secret"></i>
                            </div>
                            <div class="stat-info">
                                <h3>{{ formatNumber(stats.suspectedUsers) }}</h3>
                                <p>可疑用户数</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-box">
                            <h3>AIGC检测比例分布</h3>
                            <canvas ref="aigcChart"></canvas>
                        </div>
                        <div class="chart-box">
                            <h3>水军风险等级分布</h3>
                            <canvas ref="riskChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="recent-activities">
                        <h3>最近检测活动</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>任务名称</th>
                                    <th>状态</th>
                                    <th>结果</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="activity in recentActivities" :key="activity.id">
                                    <td>{{ activity.time }}</td>
                                    <td>{{ activity.taskName }}</td>
                                    <td><span :class="'status-' + activity.status">{{ activity.statusText }}</span></td>
                                    <td>{{ activity.result }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 数据管理页面 -->
                <div v-if="activeTab === 'dataManagement'" class="data-management">
                    <h2><i class="fas fa-database"></i> 数据管理</h2>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" @click="openImportModal">
                            <i class="fas fa-upload"></i> 导入评论数据
                        </button>
                        <button class="btn btn-secondary" @click="refreshData">
                            <i class="fas fa-sync-alt"></i> 刷新数据
                        </button>
                        <button class="btn btn-secondary" @click="exportData">
                            <i class="fas fa-download"></i> 导出数据
                        </button>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" placeholder="搜索评论内容、用户ID..." v-model="searchQuery" @keyup.enter="searchData">
                        <select v-model="filterPlatform">
                            <option value="">所有平台</option>
                            <option value="taobao">淘宝</option>
                            <option value="jd">京东</option>
                            <option value="douyin">抖音</option>
                            <option value="weibo">微博</option>
                        </select>
                        <input type="date" v-model="filterDateStart">
                        <span>至</span>
                        <input type="date" v-model="filterDateEnd">
                        <button class="btn btn-search" @click="searchData">
                            <i class="fas fa-search"></i> 搜索
                        </button>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>用户ID</th>
                                    <th>评论内容</th>
                                    <th>平台</th>
                                    <th>时间</th>
                                    <th>AIGC概率</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="comment in paginatedComments" :key="comment.id">
                                    <td>{{ comment.id }}</td>
                                    <td>{{ comment.userId }}</td>
                                    <td class="comment-content">{{ comment.content }}</td>
                                    <td><span class="platform-tag" :class="comment.platform">{{ getPlatformName(comment.platform) }}</span></td>
                                    <td>{{ formatDate(comment.timestamp) }}</td>
                                    <td>
                                        <div class="probability-display">
                                            <div class="probability-bar">
                                                <div class="probability-fill" :style="{width: comment.aigcProbability*100 + '%'}"></div>
                                            </div>
                                            <span>{{ (comment.aigcProbability*100).toFixed(1) }}%</span>
                                        </div>
                                    </td>
                                    <td>
                                        <button class="btn-icon" @click="viewComment(comment.id)" title="查看详情">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn-icon" @click="editComment(comment.id)" title="编辑">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-icon btn-danger" @click="deleteComment(comment.id)" title="删除">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="pagination">
                            <button @click="prevPage" :disabled="currentPage === 1">上一页</button>
                            <span>第 {{ currentPage }} 页 / 共 {{ totalPages }} 页 ({{ filteredComments.length }} 条记录)</span>
                            <button @click="nextPage" :disabled="currentPage === totalPages">下一页</button>
                        </div>
                    </div>
                </div>

                <!-- AI检测分析页面 -->
                <div v-if="activeTab === 'aiDetection'" class="ai-detection">
                    <h2><i class="fas fa-search"></i> AI检测分析</h2>
                    
                    <div class="detection-panel">
                        <div class="detection-controls">
                            <div class="control-group">
                                <label>检测模式:</label>
                                <select v-model="detectionMode">
                                    <option value="single">单条评论检测</option>
                                    <option value="batch">批量检测</option>
                                    <option value="realtime">实时监测</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label>检测范围:</label>
                                <select v-model="detectionScope">
                                    <option value="all">全部评论</option>
                                    <option value="recent">最近7天</option>
                                    <option value="selected">仅选中用户</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label>检测算法:</label>
                                <select v-model="detectionAlgorithm">
                                    <option value="bert">BERT模型</option>
                                    <option value="ensemble">集成学习</option>
                                    <option value="deep">深度学习</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" @click="startDetection" 
                                    :disabled="detectionInProgress || (detectionScope === 'selected' && selectedUsersForDetection.length === 0)">
                                <i class="fas fa-play"></i> 
                                {{ detectionInProgress ? '检测中...' : '开始检测分析' }}
                            </button>
                            
                            <div class="detection-progress" v-if="detectionInProgress">
                                <div class="progress-bar">
                                    <div class="progress-fill" :style="{width: detectionProgress + '%'}"></div>
                                </div>
                                <span>{{ detectionProgress }}%</span>
                            </div>
                        </div>
                        
                        <div class="detection-input" v-if="detectionMode === 'single'">
                            <textarea v-model="singleCommentText" placeholder="输入待检测的评论内容..." rows="3"></textarea>
                            <button class="btn btn-secondary" @click="detectSingleComment">
                                <i class="fas fa-search"></i> 立即检测
                            </button>
                        </div>
                    </div>
                    
                    <div class="results-container">
                        <div class="results-summary">
                            <h3>检测结果概览</h3>
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <div class="summary-value">{{ aigcDetectionResults.total }}</div>
                                    <div class="summary-label">检测评论总数</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-value" style="color: #FF5722;">{{ aigcDetectionResults.aigcCount }}</div>
                                    <div class="summary-label">AIGC疑似评论</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-value">{{ aigcDetectionResults.averageProbability.toFixed(2) }}</div>
                                    <div class="summary-label">平均AIGC概率</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-value">{{ aigcDetectionResults.clustersFound }}</div>
                                    <div class="summary-label">发现集群数</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detailed-results">
                            <div class="results-header">
                                <h3>详细检测结果</h3>
                                <div class="results-actions">
                                    <button class="btn btn-secondary" @click="exportResults">
                                        <i class="fas fa-download"></i> 导出结果
                                    </button>
                                    <button class="btn btn-secondary" @click="clearResults">
                                        <i class="fas fa-trash"></i> 清空结果
                                    </button>
                                </div>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th width="50">
                                            <input type="checkbox" 
                                                   @change="toggleAllSelection" 
                                                   :checked="allSelected">
                                        </th>
                                        <th>评论ID</th>
                                        <th>用户ID</th>
                                        <th>评论内容</th>
                                        <th>AIGC概率</th>
                                        <th>风险等级</th>
                                        <th>检测时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="result in detectionDetails" :key="result.id">
                                        <td>
                                            <input type="checkbox" 
                                                   v-model="result.selected"
                                                   @change="toggleUserSelection(result.id)">
                                        </td>
                                        <td>{{ result.id }}</td>
                                        <td>{{ result.userId }}</td>
                                        <td class="comment-preview">{{ result.content }}</td>
                                        <td>
                                            <div class="probability-display">
                                                <div class="probability-bar">
                                                    <div class="probability-fill" :style="{width: result.probability*100 + '%'}"></div>
                                                </div>
                                                <span>{{ (result.probability*100).toFixed(1) }}%</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span :class="'risk-level risk-' + result.riskLevel">{{ getRiskLevelName(result.riskLevel) }}</span>
                                        </td>
                                        <td>{{ formatDate(result.detectedAt) }}</td>
                                        <td>
                                            <button class="btn-icon" @click="viewDetails(result.id)" title="查看详情">
                                                <i class="fas fa-info-circle"></i>
                                            </button>
                                            <button class="btn-icon" @click="markAsWaterArmy(result.id)" title="标记为水军">
                                                <i class="fas fa-flag"></i>
                                            </button>
                                            <button class="btn-icon" @click="addToBlacklist(result.userId)" title="加入黑名单">
                                                <i class="fas fa-ban"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 可视化分析页面 -->
                <div v-if="activeTab === 'visualization'" class="visualization">
                    <h2><i class="fas fa-chart-network"></i> 可视化分析</h2>
                    
                    <div class="visualization-controls">
                        <div class="control-group">
                            <label>可视化类型:</label>
                            <select v-model="visualizationType" @change="updateVisualization">
                                <option value="network">水军网络关系图</option>
                                <option value="timeline">时间线分析</option>
                                <option value="heatmap">热力图分析</option>
                                <option value="distribution">分布图分析</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label>风险等级过滤:</label>
                            <select v-model="riskFilter" @change="updateVisualization">
                                <option value="all">全部</option>
                                <option value="high">高风险</option>
                                <option value="medium">中风险</option>
                                <option value="low">低风险</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label>时间范围:</label>
                            <select v-model="timeRange" @change="updateVisualization">
                                <option value="7d">最近7天</option>
                                <option value="30d">最近30天</option>
                                <option value="90d">最近90天</option>
                                <option value="all">全部时间</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="visualization-area">
                        <div class="network-container" v-if="visualizationType === 'network'">
                            <h3>水军集群网络关系图</h3>
                            <div class="network-graph" ref="networkGraph">
                                <!-- 动态生成网络节点 -->
                                <div v-for="(node, index) in networkNodes" 
                                     :key="'node-' + index"
                                     class="network-node"
                                     :class="'cluster-' + node.riskLevel"
                                     :style="{top: node.y + 'px', left: node.x + 'px'}"
                                     @click="selectNetworkNode(node)">
                                    <div class="node-label">{{ node.label }}</div>
                                </div>
                                <!-- 连接线 -->
                                <div v-for="(link, index) in networkLinks" 
                                     :key="'link-' + index"
                                     class="connection"
                                     :style="getLinkStyle(link)"></div>
                            </div>
                            <div class="network-legend">
                                <div class="legend-item">
                                    <div class="legend-color cluster-high"></div>
                                    <span>高风险集群</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color cluster-medium"></div>
                                    <span>中风险集群</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color cluster-low"></div>
                                    <span>低风险集群</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" v-if="visualizationType === 'timeline'">
                            <h3>水军活动时间线</h3>
                            <canvas ref="timelineChart"></canvas>
                        </div>
                        
                        <div class="chart-container" v-if="visualizationType === 'heatmap'">
                            <h3>水军活动热力图</h3>
                            <canvas ref="heatmapChart"></canvas>
                        </div>
                        
                        <div class="chart-container" v-if="visualizationType === 'distribution'">
                            <h3>评论分布分析</h3>
                            <canvas ref="distributionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="evidence-chain" v-if="selectedNode">
                        <h3>证据链查看 - {{ selectedNode.label }}</h3>
                        <div class="evidence-container">
                            <div class="evidence-item">
                                <div class="evidence-header">
                                    <h4>集群ID: {{ selectedNode.id }}</h4>
                                    <span :class="'risk-level risk-' + selectedNode.riskLevel">{{ getRiskLevelName(selectedNode.riskLevel) }}</span>
                                </div>
                                <div class="evidence-content">
                                    <p><strong>关联用户数:</strong> {{ selectedNode.userCount }} 人</p>
                                    <p><strong>评论数量:</strong> {{ selectedNode.commentCount }} 条</p>
                                    <p><strong>平均AIGC概率:</strong> {{ (selectedNode.avgProbability * 100).toFixed(1) }}%</p>
                                    <p><strong>主要平台:</strong> {{ selectedNode.mainPlatform }}</p>
                                    <p><strong>行为模式:</strong> {{ selectedNode.behaviorPattern }}</p>
                                    <p><strong>首次发现时间:</strong> {{ formatDate(selectedNode.firstSeen) }}</p>
                                    <p><strong>最近活跃时间:</strong> {{ formatDate(selectedNode.lastActive) }}</p>
                                </div>
                                <div class="evidence-actions">
                                    <button class="btn btn-primary" @click="viewClusterDetails(selectedNode)">
                                        <i class="fas fa-search"></i> 查看详情
                                    </button>
                                    <button class="btn btn-secondary" @click="exportClusterData(selectedNode)">
                                        <i class="fas fa-download"></i> 导出数据
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统管理页面 -->
                <div v-if="activeTab === 'systemManagement'" class="system-management">
                    <h2><i class="fas fa-cog"></i> 系统管理</h2>
                    
                    <div class="management-tabs">
                        <button :class="{active: managementTab === 'users'}" @click="managementTab = 'users'">
                            <i class="fas fa-users"></i> 用户管理
                        </button>
                        <button :class="{active: managementTab === 'tasks'}" @click="managementTab = 'tasks'">
                            <i class="fas fa-tasks"></i> 任务管理
                        </button>
                        <button :class="{active: managementTab === 'system'}" @click="managementTab = 'system'">
                            <i class="fas fa-cogs"></i> 系统设置
                        </button>
                        <button :class="{active: managementTab === 'logs'}" @click="managementTab = 'logs'">
                            <i class="fas fa-history"></i> 操作日志
                        </button>
                    </div>
                    
                    <!-- 用户管理 -->
                    <div v-if="managementTab === 'users'" class="users-management">
                        <div class="section-header">
                            <h3>用户列表</h3>
                            <button class="btn btn-primary" @click="openAddUserModal">
                                <i class="fas fa-user-plus"></i> 添加用户
                            </button>
                        </div>
                        
                        <table class="management-table">
                            <thead>
                                <tr>
                                    <th>用户名</th>
                                    <th>角色</th>
                                    <th>邮箱</th>
                                    <th>创建时间</th>
                                    <th>最后登录</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="user in systemUsers" :key="user.id">
                                    <td>{{ user.username }}</td>
                                    <td><span :class="'role-tag role-' + user.role">{{ user.roleName }}</span></td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.createdAt }}</td>
                                    <td>{{ user.lastLogin || '从未登录' }}</td>
                                    <td>
                                        <span :class="'status-' + user.status">
                                            {{ user.status === 'active' ? '活跃' : '禁用' }}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn-icon" @click="editUser(user.id)" title="编辑">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-icon" 
                                                :class="user.status === 'active' ? 'btn-warning' : 'btn-success'"
                                                @click="toggleUserStatus(user.id)" 
                                                :title="user.status === 'active' ? '禁用' : '启用'">
                                            <i :class="user.status === 'active' ? 'fas fa-ban' : 'fas fa-check'"></i>
                                        </button>
                                        <button class="btn-icon btn-danger" @click="deleteUser(user.id)" title="删除">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 任务管理 -->
                    <div v-if="managementTab === 'tasks'" class="tasks-management">
                        <div class="section-header">
                            <h3>检测任务管理</h3>
                            <button class="btn btn-primary" @click="createNewTask">
                                <i class="fas fa-plus"></i> 创建新任务
                            </button>
                        </div>
                        
                        <div class="tasks-list">
                            <div class="task-item" v-for="task in detectionTasks" :key="task.id">
                                <div class="task-info">
                                    <h4>{{ task.name }}</h4>
                                    <p>{{ task.description }}</p>
                                    <div class="task-meta">
                                        <span><i class="fas fa-calendar"></i> {{ task.createdAt }}</span>
                                        <span><i class="fas fa-user"></i> {{ task.createdBy }}</span>
                                        <span v-if="task.schedule"><i class="fas fa-clock"></i> {{ task.schedule }}</span>
                                    </div>
                                </div>
                                <div class="task-status">
                                    <span :class="'task-status-' + task.status">{{ task.statusText }}</span>
                                    <div v-if="task.status === 'running'" class="task-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" :style="{width: task.progress + '%'}"></div>
                                        </div>
                                        <span>{{ task.progress }}%</span>
                                    </div>
                                </div>
                                <div class="task-actions">
                                    <button class="btn-icon" @click="viewTask(task.id)" title="查看详情">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button v-if="task.status === 'pending'" class="btn-icon" @click="startTask(task.id)" title="启动任务">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button v-if="task.status === 'running'" class="btn-icon" @click="stopTask(task.id)" title="停止任务">
                                        <i class="fas fa-stop"></i>
                                    </button>
                                    <button v-if="task.status === 'completed'" class="btn-icon" @click="viewTaskResults(task.id)" title="查看结果">
                                        <i class="fas fa-chart-bar"></i>
                                    </button>
                                    <button class="btn-icon btn-danger" @click="deleteTask(task.id)" title="删除任务">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 系统设置 -->
                    <div v-if="managementTab === 'system'" class="system-settings">
                        <div class="settings-section">
                            <h3><i class="fas fa-sliders-h"></i> 系统配置</h3>
                            <div class="settings-form">
                                <div class="form-group">
                                    <label>系统名称:</label>
                                    <input type="text" v-model="systemSettings.systemName" placeholder="AI水军检测系统">
                                </div>
                                <div class="form-group">
                                    <label>AIGC检测阈值:</label>
                                    <input type="range" v-model="systemSettings.aigcThreshold" min="0" max="100" step="1">
                                    <span>{{ systemSettings.aigcThreshold }}%</span>
                                </div>
                                <div class="form-group">
                                    <label>自动检测间隔:</label>
                                    <select v-model="systemSettings.autoDetectionInterval">
                                        <option value="3600">1小时</option>
                                        <option value="7200">2小时</option>
                                        <option value="21600">6小时</option>
                                        <option value="43200">12小时</option>
                                        <option value="86400">24小时</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>数据保留天数:</label>
                                    <input type="number" v-model="systemSettings.dataRetentionDays" min="30" max="365">
                                </div>
                                <button class="btn btn-primary" @click="saveSystemSettings">
                                    <i class="fas fa-save"></i> 保存设置
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 操作日志 -->
                    <div v-if="managementTab === 'logs'" class="system-logs">
                        <div class="section-header">
                            <h3>系统操作日志</h3>
                            <button class="btn btn-secondary" @click="refreshLogs">
                                <i class="fas fa-sync-alt"></i> 刷新
                            </button>
                        </div>
                        <div class="logs-container">
                            <table class="logs-table">
                                <thead>
                                    <tr>
                                        <th>时间</th>
                                        <th>用户</th>
                                        <th>操作</th>
                                        <th>详情</th>
                                        <th>IP地址</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="log in systemLogs" :key="log.id">
                                        <td>{{ log.timestamp }}</td>
                                        <td>{{ log.username }}</td>
                                        <td><span :class="'log-type-' + log.type">{{ log.operation }}</span></td>
                                        <td>{{ log.details }}</td>
                                        <td>{{ log.ipAddress }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- 模态框 - 导入数据 -->
        <div v-if="showImportModal" class="modal-overlay" @click.self="closeModal('import')">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3><i class="fas fa-upload"></i> 导入评论数据</h3>
                    <button class="close-modal" @click="closeModal('import')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="import-options">
                        <div class="option">
                            <input type="radio" id="importFile" name="importType" value="file" v-model="importType">
                            <label for="importFile">文件上传</label>
                            <div v-if="importType === 'file'" class="option-details">
                                <p>支持格式: CSV, JSON, Excel</p>
                                <div class="file-upload-area" @click="triggerFileUpload" @dragover.prevent @drop="handleFileDrop">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>点击或拖拽文件到此处</p>
                                    <input type="file" id="fileUpload" @change="handleFileSelect" style="display: none;" accept=".csv,.json,.xlsx,.xls">
                                </div>
                                <div v-if="selectedFile" class="selected-file">
                                    <i class="fas fa-file"></i>
                                    <span>{{ selectedFile.name }} ({{ formatFileSize(selectedFile.size) }})</span>
                                    <button @click="removeFile" class="btn-icon btn-danger">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="option">
                            <input type="radio" id="importAPI" name="importType" value="api" v-model="importType">
                            <label for="importAPI">API接口</label>
                            <div v-if="importType === 'api'" class="option-details">
                                <div class="form-group">
                                    <label>API地址:</label>
                                    <input type="text" v-model="apiEndpoint" placeholder="https://api.example.com/comments">
                                </div>
                                <div class="form-group">
                                    <label>API密钥:</label>
                                    <input type="password" v-model="apiKey" placeholder="请输入API密钥">
                                </div>
                                <div class="form-group">
                                    <label>数据量限制:</label>
                                    <input type="number" v-model="apiLimit" placeholder="最大记录数">
                                </div>
                            </div>
                        </div>
                        
                        <div class="option">
                            <input type="radio" id="importManual" name="importType" value="manual" v-model="importType">
                            <label for="importManual">手动输入</label>
                            <div v-if="importType === 'manual'" class="option-details">
                                <div class="form-group">
                                    <label>平台:</label>
                                    <select v-model="manualPlatform">
                                        <option value="taobao">淘宝</option>
                                        <option value="jd">京东</option>
                                        <option value="douyin">抖音</option>
                                        <option value="weibo">微博</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>评论内容:</label>
                                    <textarea v-model="manualContent" rows="4" placeholder="输入评论内容..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>用户ID:</label>
                                    <input type="text" v-model="manualUserId" placeholder="用户ID">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="importProgress > 0" class="import-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{width: importProgress + '%'}"></div>
                        </div>
                        <span>{{ importProgress }}% - {{ importStatus }}</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="closeModal('import')">取消</button>
                    <button class="btn btn-primary" @click="confirmImport" :disabled="importing">
                        <i class="fas fa-upload"></i> {{ importing ? '导入中...' : '确认导入' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- 用户行为分析模态框 -->
        <div v-if="showUserAnalysisModal" class="modal-overlay" @click.self="closeModal('userAnalysis')">
            <div class="modal user-analysis-modal" @click.stop>
                <div class="modal-header">
                    <h3><i class="fas fa-user-shield"></i> 用户行为分析报告</h3>
                    <button class="close-modal" @click="closeModal('userAnalysis')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="analysis-results" v-if="currentUserAnalysis">
                        <div class="analysis-section">
                            <h4>用户信息</h4>
                            <div class="user-info-grid">
                                <div><strong>用户ID:</strong> {{ currentUserAnalysis.userId }}</div>
                                <div><strong>IP地址:</strong> {{ currentUserAnalysis.ipAddress || '未知' }}</div>
                                <div><strong>平台:</strong> {{ currentUserAnalysis.platform || '多平台' }}</div>
                                <div><strong>分析时间:</strong> {{ formatDate(new Date()) }}</div>
                            </div>
                        </div>
                        
                        <div class="analysis-section">
                            <h4>风险评分</h4>
                            <div class="risk-score-display">
                                <div class="risk-score" 
                                     :class="currentUserAnalysis.risk_score > 0.7 ? 'high' : 
                                             currentUserAnalysis.risk_score > 0.4 ? 'medium' : 'low'">
                                    {{ (currentUserAnalysis.risk_score * 100).toFixed(1) }}%
                                </div>
                                <div class="risk-description">
                                    <p v-if="currentUserAnalysis.risk_score > 0.7" style="color: #c62828;">
                                        <i class="fas fa-exclamation-triangle"></i> 高风险用户 - 高度疑似水军
                                    </p>
                                    <p v-else-if="currentUserAnalysis.risk_score > 0.4" style="color: #ef6c00;">
                                        <i class="fas fa-exclamation-circle"></i> 中风险用户 - 需要监控
                                    </p>
                                    <p v-else style="color: #2e7d32;">
                                        <i class="fas fa-check-circle"></i> 低风险用户 - 正常用户
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="analysis-section" v-if="currentUserAnalysis.suspicious_factors && currentUserAnalysis.suspicious_factors.length > 0">
                            <h4>可疑因素</h4>
                            <ul class="suspicious-factors">
                                <li v-for="(factor, index) in currentUserAnalysis.suspicious_factors" 
                                    :key="index">
                                    <i class="fas fa-exclamation-circle"></i> {{ factor }}
                                </li>
                            </ul>
                        </div>
                        
                        <div class="analysis-section" v-if="currentUserAnalysis.behavior_pattern">
                            <h4>行为模式分析</h4>
                            <table class="behavior-pattern">
                                <thead>
                                    <tr>
                                        <th>指标</th>
                                        <th>数值</th>
                                        <th>说明</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(value, key) in currentUserAnalysis.behavior_pattern" 
                                        :key="key">
                                        <td>{{ getBehaviorLabel(key) }}</td>
                                        <td>{{ value }}</td>
                                        <td>
                                            <span v-if="isSuspiciousBehavior(key, value)" style="color: #c62828;">
                                                <i class="fas fa-exclamation-triangle"></i> 可疑
                                            </span>
                                            <span v-else style="color: #2e7d32;">
                                                <i class="fas fa-check"></i> 正常
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="analysis-section" v-if="currentUserAnalysis.recommendations && currentUserAnalysis.recommendations.length > 0">
                            <h4>处理建议</h4>
                            <ul class="recommendations">
                                <li v-for="(recommendation, index) in currentUserAnalysis.recommendations" 
                                    :key="index">
                                    <i class="fas fa-check-circle"></i> {{ recommendation }}
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div v-else class="loading">
                        <i class="fas fa-spinner fa-spin"></i> 正在加载分析结果...
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="closeModal('userAnalysis')">
                        关闭
                    </button>
                    <button class="btn btn-primary" 
                            v-if="currentUserAnalysis && currentUserAnalysis.risk_score > 0.7"
                            @click="markAsWaterArmyFromAnalysis">
                        <i class="fas fa-flag"></i> 标记为水军
                    </button>
                    <button class="btn btn-warning" 
                            v-if="currentUserAnalysis && currentUserAnalysis.risk_score > 0.4"
                            @click="addToMonitorList">
                        <i class="fas fa-eye"></i> 加入监控列表
                    </button>
                </div>
            </div>
        </div>

        <!-- 添加用户模态框 -->
        <div v-if="showAddUserModal" class="modal-overlay" @click.self="closeModal('addUser')">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3><i class="fas fa-user-plus"></i> 添加用户</h3>
                    <button class="close-modal" @click="closeModal('addUser')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="user-form">
                        <div class="form-group">
                            <label>用户名:</label>
                            <input type="text" v-model="newUser.username" placeholder="输入用户名">
                        </div>
                        <div class="form-group">
                            <label>邮箱:</label>
                            <input type="email" v-model="newUser.email" placeholder="输入邮箱">
                        </div>
                        <div class="form-group">
                            <label>密码:</label>
                            <input type="password" v-model="newUser.password" placeholder="输入密码">
                        </div>
                        <div class="form-group">
                            <label>确认密码:</label>
                            <input type="password" v-model="newUser.confirmPassword" placeholder="确认密码">
                        </div>
                        <div class="form-group">
                            <label>角色:</label>
                            <select v-model="newUser.role">
                                <option value="admin">系统管理员</option>
                                <option value="analyst">安全分析师</option>
                                <option value="visitor">访客</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="closeModal('addUser')">取消</button>
                    <button class="btn btn-primary" @click="saveNewUser" :disabled="!isValidUserForm">
                        <i class="fas fa-save"></i> 保存用户
                    </button>
                </div>
            </div>
        </div>

        <!-- 系统通知 -->
        <div v-if="notifications.length > 0" class="notifications">
            <div v-for="notification in notifications" 
                 :key="notification.id"
                 class="notification"
                 :class="'notification-' + notification.type">
                <i :class="getNotificationIcon(notification.type)"></i>
                <span>{{ notification.message }}</span>
                <button class="close-notification" @click="removeNotification(notification.id)">
                    &times;
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>